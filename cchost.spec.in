%define buildver PROJECT_VERSION
%define specrel 1

# CVS versions are pre-releases and must be treated differently than "real"
# releases, because otherwise we end up with a version "xyzCVS", which rpm
# thinks is "newer" than a version "xyz", although in fact it's the other way
# around. The fix for this is to strip off the "CVS" from the version number
# and use it in the "release" field instead.
%define rawversion %(echo "%{buildver}" | %{__sed} -e 's@CVS$@@')
%define cvsrelease %(echo "%{buildver}" | %{__sed} -e 's@^.*CVS$@CVS@')
%define releasever %(if [ "%{cvsrelease}" = "CVS" ]; then echo "0.CVS.%{specrel}"; else echo "%{specrel}"; fi)

%define _webdir /opt/%{name}

Summary:	ccHost is an open source project that provides web-based infrastructure to support collaboration, sharing, and storage of multi-media using the Creative Commons licenses and metadata.	
Name:		cchost
Epoch:		1
Version:	%{rawversion}
Release:	%{releasever}
License:	GPL
Group:		Applications/Internet
URL:		http://sourceforge.net/projects/cctools/
BuildArch:	noarch
Source:		http://dl.sf.net/cctools/cchost-%{buildver}.tar.bz2
Requires:	php >= 4.3, mysql >= 4 
BuildRoot:	%{_tmppath}/%{name}-%{buildver}-%{release}-root

%description
The goal of this project is to spread media content that is licensed under 
Creative Commons throughout the web in much the same way that weblogs spread CC
licensed text. The more installations of ccHost and its variations, the more 
content there will be available for enjoyment and artistic re-use in a sane 
and legal setting.

%prep
%setup -q -n %{name}-%{buildver}

%build
%{__make}

%install
[ "%{buildroot}" != "/" -a -n "%{buildroot}" ] && %{__rm} -rf "%{buildroot}"
%{__make} install DESTDIR="%{buildroot}" \
	BINDIR=%{_bindir} \
	MANDIR=%{_mandir} \
	MANCOMPRESS= \
	INSTALL=%{__install}

%clean
[ "%{buildroot}" != "/" -a -n "%{buildroot}" ] && %{__rm} -rf "%{buildroot}"

%files
# NOTE: This section is only to locate where make install puts files so that
# they can be removed as easily as make uninstall...so not much magic here
# http://rpm.org/RPM-HOWTO/build.html
%defattr(-,root,root,0755)
%doc COPYING ChangeLog README NEWS PRESS LICENSE.TXT AUTHORS
%{_webdir}/*


%changelog
* Tue Mar  28 2006 Jon Phillips <jon@creativecommons.org> 2.0
- Finishing packaging to add files to a web dir...
* Thu Feb  23 2006 Jon Phillips <jon@creativecommons.org> 1.1
- Trying to get this rpm packaging right for release
* Fri Oct  18 2005 Jon Phillips <jon@creativecommons.org> 1.0.2
- first build of the rpm packager

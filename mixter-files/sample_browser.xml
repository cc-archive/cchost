<tal:block>
<tal:block replace="">
<!--

Creative Commons has made the contents of this file
available under a CC-GNU-GPL license:

 http://creativecommons.org/licenses/GPL/2.0/

 A copy of the full license can be found as part of this
 distribution in the file LICENSE.TXT

You may use the ccHost software in accordance with the
terms of that license. You agree that you are solely 
responsible for your use of the ccHost software and you
represent and warrant to Creative Commons that your use
of the ccHost software will comply with the CC-GNU-GPL.

$Id: page.xml 3449 2006-06-14 19:31:05Z kidproto $

-->
</tal:block>

<metal:block use-macro="${browser_macro}" />

<metal:block define-macro="browser_page">

<h1>Samples Browser [BETA]</h1>
  <script>
  //<!--
  var tags = new Array();
  var tag_filter = 'any';

  function tag_checked(cb)
  {
     var namespan = new cc_obj( 'name_' + cb.name );
     if( cb.checked )
     {
       namespan.style.fontWeight = 'bold';
       tags.push( cb.name );
       var clear_btn = new cc_obj('btn_clear');
       clear_btn.obj.disabled = false;
     }
     else
     {
       namespan.style.fontWeight = 'normal';

       var tagarr = new Array();
       var i;
       var n = 0;
       for( i = 0; i < tags.length; i++ )
       {
          if( tags[i] != cb.name )
            tagarr[n++] = tags[i];
       }
       tags = tagarr;
     }

     do_get_data();
  }

  function do_get_data()
  {
     var tagstr = tags.join( ',' );
     cc_get_data( "${home-url}samples/list?tags=" + tagstr + '&tf=' + tag_filter, 
                  'sample_browser', 
                  '<span class="sb_msg">Hold on... looking up samples...</span>' );
  }

  function new_tag_sort(selobj)
  {
    var newval = selobj.options[ selobj.selectedIndex ].value;
    var loc = get_base_url();
    document.location = loc + '?ts=' + newval;
  }

  function new_tag_limiter(selobj)
  {
    var newval = selobj.options[ selobj.selectedIndex ].value;
    var loc = get_base_url();
    document.location = loc + '?sa=' + newval;
  }

  function new_tag_filter(selobj)
  {
    var newval = selobj.options[ selobj.selectedIndex ].value;
    tag_filter = newval;
    do_get_data();
  }

  function get_base_url()
  {
    var loc = '' + document.location;
    var regex = new RegExp(/\?..=[0-9a-z]+/);
    if( regex.exec( loc ) )
       loc = loc.replace( regex, '' );
    return loc;
  }

  function clear_all(btn)
  {
      do_clear_all(btn);
      do_get_data();
  }

  function do_clear_all(btn)
  {
      btn.disabled = true;
      for( i = 0; i < tags.length; i++ )
      {
        var checkbox = new cc_obj(tags[i]);
        checkbox.obj.checked = false;
        var namespan = new cc_obj( 'name_' + tags[i] );
        namespan.style.fontWeight = 'normal';
      }
      tags = new Array();
  }

  function do_search()
  {
     var btn = new cc_obj('btn_clear');
     do_clear_all(btn);

     var input = new cc_obj('sampsearch');
     var str   = input.obj.value;

     cc_get_data( "${home-url}samples/search?term=" + str, 
                  'sample_browser', 
                  '<span class="sb_msg">Hold on... looking up samples...</span>' );
  }

  // -->
  </script>
  <style>

  /* --- Two main areas: ---- */

  #controls {
    width: 220px;
    margin-left: 10px;
    background-color: #DDD;
    border: 2px solid #999;
    padding-bottom: 23px;
  }

  #sample_browser {
    float: right;
    width: 450px;
    border: 2px solid #999;
    height: 480px;
    background-color: #EEE;
    padding: 8px;
  }

  /* ------------------------ */

  #results_container {
     overflow: scroll;
     width: 100%;
     height: 420px;
  }

  #results_header {
    height: 30px;
    padding: 4px;
    font-weight: bold;
    background: #999;
  }


  .sb_msg {
    font-family: arial;
    font-size: 14px;
    font-style: italic;
    display: block;
    margin: 10px;
  }

  .down_button, .hear_button {
    display: block;
    width: 17px;
    height: 17px;
  }
  .down_button {
    background: url('/cctemplates/ccmixter/down-button-fg.gif');
  }
  .down_button:hover {
    background: url('/cctemplates/ccmixter/down-button-bg.gif');
  }
  .hear_button {
    background: url('/cctemplates/ccmixter/hear-button-fg.gif');
  }
  .hear_button:hover {
    background: url('/cctemplates/ccmixter/hear-button-bg.gif');
  }

  #sampsearch, #btn_search, #dd_tag_sorter, 
  #dd_tag_filter, #btn_clear, #dd_tag_limiter {
     font-family: Verdana;
     font-size: 10px;
  }

  #search_ctrls {
    padding: 8px 8px 20px 8px;
    background-color: white;
    border-bottom: 2px solid #999;
    }

  #search_caption {
    display: block;
    font-weight: bold;
    margin: 0px 0px 10px 0px;
  }

  #sampsearch {
    margin: 0px;
    width: 200px;
  }

  #btn_search {
    margin: 5px 0px 2px 150px;
    display: block;
  }

  #dd_tag_sorter {
  }

  #tag_filter {
     margin: 5px 0px 6px 4px;
  }

  #dd_tag_filter {
  }


  #btn_clear {
     float: left;
     margin: 0px 23px 20px 8px;
  }

  #picker_caption {
     margin: 8px 4px 8px 4px;
     display: block;
     font-weight: bold;
  }

  #tags_container {
     height: 320px;
     overflow: scroll;
     scrollbar-track-color: black;
     background-color: white;
     margin: 1px 4px 8px 4px;
  }
  
  #taglist {
  }

  .tagcheck {
  }

  .tb {
  }

  .tbc {
  }

  #results_caption {
  }

  #term_caption span {
    font-weight: bold;
    font-style: italic;
    color: white;
  }

  #results_table {
    width: 100%;
  }

  #results_table td, table.files td {
    vertical-align: top;
  }

  .row_even {
  }

  .row_odd {
    background: #ddF;
  }

  td.filelink {
    padding-left: 8px;
  }

  td.userlink {
  }

  table.files {
  }

  td.dbutton, td.sbutton {
    width: 18px;
  }

  td.nicname {
    width: 40px;
    font-size: 10px;
  }

  td.bpm {
    width: 20px;
    font-size: 10px;
    color: #677;

 }
  </style>
<div id="sample_browser">
  ${default_msg}
</div>

<div id="controls">

<div id="search_ctrls">
<span id="search_caption" >${search_caption}</span>
<input id="sampsearch" type="text" />

<input type="button" value="${search_text}" onclick="do_search(this);" id="btn_search"/>
</div>

<span id="picker_caption">${picker_caption}</span>

<div id="tags_container">
  <table cellpadding="0" cellspacing="0" id="taglist">
  <tal:block repeat="tagrec tags">
     <tr><td class="tagcheck"><input onclick="tag_checked(this)" 
              type="checkbox" id="${tagrec/tags_tag}" name="${tagrec/tags_tag}" /> 
         </td>
         <td class="tb"><label for="${tagrec/tags_tag}" 
              id="name_${tagrec/tags_tag}">${tagrec/tags_tag}</label> <span 
              class="tbc">(${tagrec/tags_count})</span></td>
     </tr>
  </tal:block>
  </table>
</div>

<input type="button" value="Clear all" disabled="disabled" onclick="clear_all(this);" id="btn_clear"/>

<tal:block replace=''>
 <select onchange="new_tag_sort(this)" id="dd_tag_sorter" class="toggler">
   <tal:block repeat="tag_sort tag_sorts">
          <tal:block condition="tag_sort/selected">
             <option selected="1" value="${tag_sort/value}">${tag_sort/text}</option>
          </tal:block>
          <tal:block condition="not: tag_sort/selected">
             <option value="${tag_sort/value}">${tag_sort/text}</option>
          </tal:block>
       </tal:block>
</select>
</tal:block>

<div id="tag_filter">
  <select onchange="new_tag_filter(this)" id="dd_tag_filter" class="toggler">
         <option value='any' select="1">Match any tags</option>
         <option value='all'>Match all tags</option>
  </select>
</div>

<select onchange="new_tag_limiter(this)" id="dd_tag_limiter" >
   <tal:block repeat="TL tag_limiters">
          <tal:block condition="TL/selected">
             <option selected="1" value="${TL/value}">${TL/text}</option>
          </tal:block>
          <tal:block condition="not: TL/selected">
             <option value="${TL/value}">${TL/text}</option>
          </tal:block>
   </tal:block>
</select>

</div>

</metal:block>

<metal:block define-macro="browser_list">

    <div id="results_header">
      <span id="term_caption">${term_caption}: <span>${term}</span></span>
      <span id="results_caption">${results_caption}</span>
    </div>

    <div id="results_container">
      <table id="results_table"  cellpadding="0" cellspacing="0">
          <tal:block repeat="R records">
            <tr class="row_${R/odd}">
             <td class="filelink"><a href="${R/file_page_url}" class="cc_file_link"><span tal:content="php: CC_strchop('${R/upload_name}',26);" /></a></td>
             <td class="bpm" >
               <tal:block condition="R/upload_extra/bpm"><span 
                   tal:content="R/upload_extra/bpm" />bpm</tal:block>
             </td>
             <td class="userlink"><a class="cc_user_link" href="${R/artist_page_url}"><span 
                 tal:content="php: CC_strchop('${R/user_real_name}',12);" /></a></td>
             <td>
               <table  cellpadding="0" cellspacing="0" class="files">
                 <tr tal:repeat="F R/files">
                   <td class="dbutton"><a class="down_button" href="${F/download_url}">&nbsp;</a></td>
                   <td class="sbutton"><tal:block condition="F/is_audio"> <a href="/media/samples/stream/${F/file_id}.m3u" class="hear_button">&nbsp; </a></tal:block>
                   </td>
                   <td class="nicname">${F/file_nicname} <span>${F/file_filesize}</span></td>
                 </tr>
               </table>
             </td>
           </tr>
          </tal:block>
      </table>
    </div>
</metal:block>

</tal:block>
<tal:block>
<tal:block replace="">
<!--
/*
* Creative Commons has made the contents of this file
* available under a CC-GNU-GPL license:
*
* http://creativecommons.org/licenses/GPL/2.0/
*
* A copy of the full license can be found as part of this
* distribution in the file LICENSE.TXT.
* 
* You may use the ccHost software in accordance with the
* terms of that license. You agree that you are solely 
* responsible for your use of the ccHost software and you
* represent and warrant to Creative Commons that your use
* of the ccHost software will comply with the CC-GNU-GPL.
*
* $Header$
*
*/
-->
</tal:block>
 
 <div tal:condition="dbmacro_names" tal:omit-tag="" tal:repeat="dbmacro_name dbmacro_names" >
    <metal:block use-macro="${dbmacro_name}" />
 </div>

<style>
table.db td
{
    vertical-align: top;
    color: green;
}
</style>

<metal:block define-macro="tables">
    <table class="db">
      <tr tal:repeat="table tables">
        <td tal:repeat="item table"><a href="/${config_root}/mixter/db/describe/${item}">[D]</a> --  <a href="/${config_root}/mixter/db/dump/${item}">${item}</a>  </td>
      </tr>
    </table>
</metal:block>

<metal:block define-macro="describe">
    <table class="db">
      <tr><th>Field</th><th>Type</th><th>NULL</th><th>Key</th><th>Default</th><th>Extra</th></tr>
      <tr tal:repeat="fields table">
        <td tal:repeat="item fields">${item}</td>
      </tr>
    </table>
</metal:block>

<metal:block define-macro="d_records">
<div talcc:on-error="string:something bad happened" >

<style>
table.db td
{
    vertical-align: top;
    color: green;
}
table.db th
{
  background: #888;
  padding-left: 4px;
  padding-right: 4px;
    text-align: left;
}
table.db th a
{
  color: white;
}
input.filter
{
  font-size: 10px;
  width: 100%;
}
li { display: inline; }
</style>
    <form action="${db/urlbase}" method="post">
      <h3>Click on column headings to sort</h3>
      <ul>
        <li><input type="submit" id="filter" name="filter" value="Filter" /></li>
        <li><input type="submit" id="like"   name="like"   value="Filter with 'LIKE'" /></li>
        <li><a href="${home-url}mixter/db">db Home</a></li>
      </ul>
      <table class="db">
        <tr >
          <th tal:repeat="head db/heads"><a href="${db/urlbase}?scol=${head/Field}&dir=${db/dir}">${head/Field}</a></th>
        </tr>
        <tr >
          <td tal:repeat="head db/heads"><input type="text" name="where[${head/Field}]" class="filter" /></td>
        </tr>
        <tr tal:repeat="rec db/dbrecords">
          <td tal:repeat="item rec">
            <a tal:condition="repeat/item/start" href="/${db/config_root}/mixter/db/edit/${db/table}/${item}">[E]</a> 
          ${item}</td>
        </tr>
      </table>
    </form>
   <metal:block use-macro="${prev_next_links}" />
</div>
</metal:block>

<metal:block define-macro="edit_record">
  <form action="/${config_root}/mixter/db/saverec" method="POST">
    <table class="db">
      <tr tal:repeat="field record">
        <th>${field/fname}</th>
           <td>
 <span tal:condition="field/static">${field/fname}</span>
 <input tal:condition="field/input"   type="text" style="width:500px" name="rec[${field/fname}]" value="${field/value}" />
 <input tal:condition="field/integer" type="text" style="width:100px" name="rec[${field/fname}]" value="${field/value}" />
 <input tal:condition="field/date" type="text" style="width:200px" name="rec[${field/fname}]" value="${field/value}" />
 <textarea tal:condition="field/textarea" style="width:500px;height:80px" name="rec[${field/fname}]">${field/value}</textarea>
           </td>
      </tr>
    </table>
    <input type="hidden" name="table" value="${table}" />
    <input type="hidden" name="key" value="${key}" />
    <input type="hidden" name="keyfield" value="${keyfield}" />
    <input type="submit" value="Submit" />
  </form>
</metal:block>

<metal:block define-macro="show_record">
    <table class="db">
      <tr tal:repeat="field record">
        <th>${repeat/field/key}</th><td>${field</td>
      </tr>
    </table>
</metal:block>


</tal:block>
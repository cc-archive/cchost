<tal:block>

<metal:block define-macro="show_collabs">
   <link rel="stylesheet" type="text/css" href="${root-url}cctemplates/collab.css" title="Default Style" />
   <style>
  .hear_button {
    background: url('${root-url}cctemplates/ccmixter/hear-button-fg.gif');
    display: block;
    width: 17px;
    height: 17px;
  }
  .hear_button:hover {
    background: url('${root-url}cctemplates/ccmixter/hear-button-bg.gif');
  }
   </style>
    <table id="collabs_table">
        <tr>
          <th>Collaboration Name</th>
          <th>Start Date</th>
          <th>Participants</th>
          <th>Project</th>
        </tr>
    <tal:block repeat="row collabs/collab_rows">
        <tr>
          <td><a class="collab_name" href="${home-url}collab/${row/collab_id}">${row/collab_name}</a></td>
          <td><span tal:content="php: CC_datefmt('${row/collab_date}','F d, Y');" /></td>
          <td>
            <tal:block repeat="u row/users">
              <a href="${home-url}people/${u/user_name}">${u/user_real_name}</a>&nbsp;
            </tal:block>
          </td>
          <td>
            <tal:block repeat="ups row/uploads">
                <a href="${home-url}api/query?f=m3u&ids=${ups/upload_id};" class="hear_button">&nbsp; </a>&nbsp;
              <a class="collab_upload" href="${ups/file_page_url}">${ups/upload_name}</a>
            </tal:block> 
          </td>
        </tr>
    </tal:block>
    </table>
</metal:block>

<metal:block define-macro="show_collab">
  <div id="collab_ajax_msg"><!-- --></div>
  <tal:block define="collab_id collab/collab/collab_id" />
  <link rel="stylesheet" type="text/css" href="${root-url}cctemplates/collab.css" title="Default Style" />
  <link rel="stylesheet" type="text/css" href="${root-url}cctemplates/skin-simple-topics.css" title="Default Style" />

    <fieldset>
      <legend tal:content="php: _('Info')" />
      <div tal:condition="collab/is_owner" style="float:right" >
        <a id="commentcommand" href="${home-url}collab/edit/${collab_id}"><span>edit</span></a>
      </div>
      <div class="cc_collab_by">Created by: <a href="${home-url}people/${collab/collab/user_name}">${collab/collab/user_real_name}</a> 
          ${collab/collab/collab_date}</div>
      <div class="cc_collab_desc">${collab/collab/collab_desc}</div>
    </fieldset>

  <div class="cc_collab_fields">
    <fieldset>
      <legend tal:content="php: _('Artists')" />
      <div class="user_lines">
        <div id="user_inserter"><!-- --></div>
      </div>
      <div id="invite_container">
      </div>
    </fieldset>

    <fieldset>
      <legend tal:content="php: _('Files')" />
      <div class="file_list" id="file_list">
      </div>
      <tal:block condition="collab/is_member">
        <iframe style="display:none;" name="upload_frame"></iframe>
        <form target="upload_frame" enctype="multipart/form-data" action="${home-url}collab/upload/file/${collab_id}" 
                method="post" id="upform" name="upform">Upload file: <select name="uptype" id="uptype">
               <option value="remix">remix</option><option value="sample">sample</option><option value="acappella">a cappella</option></select>
          <input type="file" id="upfile" name="upfile" /> name: <input name="upname" id="upname" type="text" /><select name="lic" id="lic">
            <tal:block repeat="lic collab/lics"><option value="${lic/license_id}">${lic/license_name}</option></tal:block>
          </select>
          <button id="fileok">ok</button>
        </form>
        <div id="upcover" style="position:absolute;display:none;background-color:white;"><img style="margin-left:45%" src="${root-url}ccimages/spinner.gif" /></div>
      </tal:block>
    </fieldset>

    <fieldset tal:condition="collab/is_member" >
      <legend tal:content="php: _('Conversation')" />
      <p>This conversation thread is private and only visible to members of the project:</p>
      <tal:block define="topics collab/topics" />
      <metal:block use-macro="topics.xml/list_topics" />
      <div class="c_commands">
         <a href="${home-url}collab/topic/add/${collab_id}" id="commentcommand"><span>Add Topic</span></a>
      </div>
    </fieldset>
  </div>


  <script src="${root-url}cctemplates/js/mini-rico.js" ></script>
  <script src="${root-url}cctemplates/js/autocomp.js" ></script>
  <script src="${root-url}cctemplates/js/collab.js" ></script>
  <script>
    var collab_template = '<div class="user_line" id="_user_line_#{user_name}">' +
            '<div class="user" ><a href="'+home_url+'people/#{user_name}">#{user_real_name}</a></div>' +
            '<div class="role">#{role}</div>' +
            '<div class="credit" id="_credit_#{user_name}">#{credit}</div>' +
  <tal:block condition="collab/is_owner">
            '<div><a href="javascript://edit credit" id="_user_credit_#{user_name}" class="user_cmd edit_credit"><span>credit</span></a></div>' +
            '<div><a href="javascript://remove user" id="_user_remove_#{user_name}" class="user_cmd"><span>remove</span></a></div>' +
  </tal:block>
  <tal:block condition="collab/is_member">
            '<div>' +
            '    <a href="javascript://contact" id="_contact_#{user_name}" class="user_cmd edit_contact"><span>send email</span></a> ' +
            '</div>' +
  </tal:block>
           '</div>';
     var cu = new ccCollab('${collab_id}','${collab/is_member}','${collab/is_owner}');
     cu.updateFiles('${collab_id}');
     <tal:block repeat="user collab/users">
        cu.addUser( '${user/user_name}', '${user/user_real_name}', '${user/collab_user_role}', '${user/collab_user_credit}' );
     </tal:block>
    function upload_done(upload_id,msg)
    {
      $('upcover').style.display = 'none';
      if( upload_id )
      {
        cu.updateFiles('${collab_id}');
        cu.msg('Upload succeeded.','green');
      }
      else
      {
        cu.msg('Upload failed: ' . msg,'red');
      }
    }

  </script>
</metal:block>

<metal:block define-macro="show_collab_files">
    <tal:block repeat="upload uploads">
      <div class="file_line ${upload/collab_type}_line" id="_file_line_${upload/upload_id}">
        <div class="file_info"><a class="fname" href="${upload/file_page_url}">${upload/upload_name}</a> by
               <a href="${upload/artist_page_url}">${upload/user_real_name}</a></div>

        <tal:block condition="upload/is_collab_owner">
          <div><a href="javascript://remove " id="_remove_${upload/upload_id}"  class="file_cmd file_remove"><span>remove</span></a></div>
          <div><a href="javascript://publish" id="_publish_${upload/upload_id}" class="file_cmd file_publish">
              <span id="_pubtext_${upload/upload_id}"><tal:block condition="upload/upload_published">hide</tal:block>
              <tal:block condition="not: upload/upload_published">publish</tal:block></span></a>
          </div>
          <div><a href="javascript://tags" id="_tags_${upload/upload_id}" class="file_cmd file_tags">tags</a></div>
        </tal:block>
        <div class="ccud">${upload/collab_type}</div>
        <div class="tags" id="_user_tags_${upload/upload_id}">${upload/upload_extra/usertags}</div>
        <br />
        <table class="file_dl_table">
            <tal:block repeat="file upload/files">
                <tr><td class="nic">${file/file_nicname}</td>
                    <td><a href="${file/download_url}" class="down_button"> </a></td>
                    <td>${file/file_name}</td>
                </tr>
            </tal:block>
        </table>
      </div>
    </tal:block>
</metal:block>

</tal:block>
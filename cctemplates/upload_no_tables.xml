<tal:block>
<tal:block replace="">
<!--

Creative Commons has made the contents of this file
available under a CC-GNU-GPL license:

 http://creativecommons.org/licenses/GPL/2.0/

 A copy of the full license can be found as part of this
 distribution in the file LICENSE.TXT

You may use the ccHost software in accordance with the
terms of that license. You agree that you are solely 
responsible for your use of the ccHost software and you
represent and warrant to Creative Commons that your use
of the ccHost software will comply with the CC-GNU-GPL.

$Header$

-->
</tal:block>

<metal:block define-macro="list_files_no_tables">
  <tal:block define="extrastyle nothing" />
  <tal:block condition="exists: all_tags">
    <tal:block define="extrastyle string:width:80%" />
    <metal:block use-macro="${tag_picker}" />
  </tal:block>
  <tal:block repeat="record file_records">
    <div id="cc_record_listing" style="${extrastyle}">
      <tal:block define="menu record/local_menu" />
      <div id="cc_file_info">
        <h2 tal:condition="not: record/works_page"><a href="${record/file_page_url}" tal:content="php: CC_strchop('${record/upload_name}',37,$chop)"></a></h2>
        <p class="cc_small_byline"><tal:block content="php: CC_lang('by');" /> 
          <a href="${record/artist_page_url}" class="cc_user_link" tal:content="php: CC_strchop('${record/user_real_name}',25,$chop)" /> 
          <span tal:content="php: CC_datefmt('${record/upload_date}','F d, Y h:i a')" />
        </p>
        <p class="cc_ratings_license" id="licenseline" tal:condition="record/license_url">
          <tal:block content="php: CC_lang('Licensed under:');" /> <a href="${record/license_url}" title="${record/license_name}" ><img src="${root-url}ccimages/lics/small-${record/license_logo}" /></a>
        </p>
        <tal:block condition="record/works_page"      define="tag_array record/upload_taglinks" />
        <tal:block condition="not: record/works_page" define="tag_array record/usertag_links" />
        <p class="cc_tags" tal:condition="tag_array" >
          <metal:block use-macro="${taglinks}" />
        </p>
    <tal:block define="dorr record/ratings_score | record/reviews_link" on-error="" />
        <p tal:condition="dorr" class="cc_ratings_license" >
          <tal:block condition="record/ratings_score">
            <tal:block content="php: CC_lang('User rating:');" />
            <tal:block repeat="i record/ratings"><img src="${root-url}ccimages/stars/star-${i}.gif" height="17" width="17" /></tal:block>    
              (${record/ratings_score}) 
          </tal:block> 
          <tal:block condition="record/reviews_link">
            <a tal:condition="record/reviews_link" href="${record/reviews_link/url}" tal:content="record/reviews_link/text" />
          </tal:block>
        </p>
        <p tal:condition="not: record/works_page" class="cc_contribute">
          <tal:block condition="menu/comment" repeat="mic menu/comment">
              <a class="cc_command" href="${mic/action}">${mic/menu_text}</a><tal:block 
                  condition="not: repeat/mic/end">&nbsp;/&nbsp;</tal:block>
          </tal:block>
        </p>
        <tal:block condition="record/upload_extra/edpicks">
          <p class="cc_pick_link" tal:repeat="pick record/upload_extra/edpicks">
            <img src="${root-url}ccimages/stars/star-red.gif" height="17" width="17" /> 
            <a href="${pick/review_url}" tal:content="php: CC_lang('Editorial pick...')" />
          </p>
        </tal:block>
        <div tal:condition="record/result_info" class="cc_search_result_info" tal:on-error="">${record/result_info}</div>
      </div><!-- file_info -->
      <div id="cc_action_buttons">
        <div class="cc_buttonpadding">
            <tal:block condition="record/works_page">
              <tal:block repeat="grp menu">
                <tal:block repeat="item grp">
                  <p><a href="${item/action}" tal:attributes="type item/type | nothing"  tal:on-error=""
                        id="${item/id}"><span tal:content="item/menu_text" /></a></p>
                </tal:block>
                <hr tal:condition="not: repeat/grp/end" />
              </tal:block>
            </tal:block>
            <tal:block condition="not: record/works_page">
              <tal:block condition="record/stream_link">
                  <a id="cc_streamfile" href="${record/stream_link/url}"><span tal:content="record/stream_link/text"/></a> 
              </tal:block>
              <tal:block condition="menu/download">
                  <a id="cc_downloadbutton" href="javascript: void(0);" onclick="cc_show_dl_box(event,'${record/upload_id}');" >
                      <span tal:content="php: CC_lang('Download')" />
                  </a>
                  <div class="cc_file_download_popup" id="dlmenu${record/upload_id}" style="display:none">
                      <p>
                          <tal:block content="php: CC_lang('IE: Right-click select \'Save Target As\'')" /><br />
                          <tal:block content="php: CC_lang('Mac: Control-click select \'Save Link As\'')" /><br />
                      </p>
                      <p tal:repeat="mi menu/download" ><a href="${mi/action}" id="${mi/id}" type="${mi/type}" title="${mi/tip}"><span tal:content="mi/menu_text" /></a>
                      </p>
                  </div>
              </tal:block>
            </tal:block>
        </div><!-- buttonpadding -->
      </div><!-- action_buttons -->
      <tal:block condition="record/works_page">
        <!-- works page -->
        <br clear="left" />
        <p tal:condition="record/files/0/file_format_info/ps" class="cc_file_playtime">
          <tal:block content="php: CC_lang('Length:')" />${record/files/0/file_format_info/ps}
        </p>
        <tal:block condition="record/upload_description_html">
          <tal:block define="says php: CC_lang('says'); 
                             dtitle string:${record/user_real_name} ${says}; 
                             dtext  record/upload_description_html" />
          <metal:block use-macro="${show_box}" />
        </tal:block>
        <tal:block condition="record/file_macros" repeat="macro_name record/file_macros" >
          <tal:block define="tname ${macro_name}" />
          <metal:block use-macro="${tname}" />
        </tal:block>
      </tal:block>

      <div id="cc_sample_history" tal:condition="not: record/skip_remixes">
        <metal:block use-macro="${show_remix_parents}" />
        <metal:block use-macro="${show_remix_children}" />
      </div>
    </div>  
    <div style=""><br clear="all" /></div>
    <tal:block condition="not: repeat/record/end">
      <p class="cc_songbreak" style="${extrastyle}" >&nbsp;</p>
    </tal:block>
  </tal:block>
  <metal:block use-macro="misc.xml/prev_next_links" />
</metal:block>

<metal:block define-macro="remix_line">
  <tal:block define="furl  rs/file_page_url;fname rs/upload_name     | rs/pool_item_name" tal:on-error=""/>
  <tal:block define="aurl  rs/artist_page_url;name  rs/user_real_name  | rs/pool_item_artist" tal:on-error=""/>
  <tal:block condition="repeat/rs/end" >
    <a tal:condition="more_link" class="cc_remix_more_link" href="$more_link" tal:content="php: CC_lang('More...')" />
  </tal:block>
  <p>
    <a href="$furl" class="cc_file_link" tal:content="php: CC_strchop('$fname',20,$chop)" />
    <tal:block content="php: CC_lang('by')" />
    <a href="$aurl" class="cc_user_link" tal:content="php: CC_strchop('$name',20,$chop)" />
  </p>
</metal:block>

</tal:block>